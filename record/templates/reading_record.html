{% extends 'base.html' %}
{% load static %}

{% block title %}
  読書記録
{% endblock %}

{% block css %}
  <link rel="stylesheet" href="{% static 'css/pages/reading_record.css' %}" />
{% endblock %}

{% block js %}
  <script src="{% static 'js/create-memo.js' %}"></script>
{% endblock %}

{% block content %}
  <div class="book-detail-container">
    <div class="book-detail-left">
      <img src="{{ book.thumbnail }}" alt="{{ book.title }}" />

      <div>
        {% comment %}TODO シェア機能を追加する{% endcomment %}
        <i class="fa-brands fa-x-twitter fa-lg"></i>
      </div>
    </div>

    <div class="book-detail-right">
      <h2>{{ book.title }}</h2>

      <ul class="authors-container">
        {% for author in book.authors.all %}
          <li class="author-item">
            <i class="fa-regular fa-user fa-sm"></i>
            <span>{{ author.name }}</span>
          </li>
          {% empty %}
          <li class="author-item">
            <i class="fa-regular fa-user fa-sm"></i>
            <span>-</span>
          </li>
        {% endfor %}
      </ul>

      {% comment %} 書籍ツール {% endcomment %}
      <div class="book-buttons">
        <a href="{% url 'book_detail' book.id %}" class="btn btn-info">書籍詳細へ</a>
        {% if record.finished_at %}
          <form action="{% url 'mark_as_unfinished' book.id %}" method="post">
            {% csrf_token %}
            <button type="submit" class="btn btn-warning">未読にする</button>
          </form>
        {% else %}
          <form action="{% url 'mark_as_finished' book.id %}" method="post">
            {% csrf_token %}
            <button type="submit" class="btn btn-primary">読了済みにする</button>
          </form>
        {% endif %}
      </div>

      <div>
        <div>開始日: {{ record.started_at | default_if_none:"" }}</div>
        <div>読了日: {{ record.finished_at | default_if_none:"-" }}</div>
      </div>
    </div>
  </div>

  {# メモの投稿フォーム #}
  <div class="memo-container">
    <form id="memoForm" data-action="{% url 'create_memo' book.id %}">
      {% csrf_token %}
      {{ form.content }}

      {% if form.content.errors %}
        <div class="error">{{ form.content.errors }}</div>
      {% endif %}

      <button id="createMemoButton" class="btn btn-primary">メモを追加</button>
    </form>

    <ol id="memoList">
      {% for memo in memos %}
        <li>
          <p>{{ memo.created_at }}</p>
          <p>{{ memo.content }}</p>
        </li>
        {% empty %}
        <p>まだメモはありません。</p>
      {% endfor %}
    </ol>
  </div>
{% endblock %}
